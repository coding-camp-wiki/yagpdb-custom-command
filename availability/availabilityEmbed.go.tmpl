{{ $embedTitle := "Staff In/Out" }}
{{ $embedDescription := "Which staff members are currently available to help?" }}
{{ $embedColor := 12426513 }}

{{ $emojiAvailable := "âœ…" }}
{{ $emojiRemove := "ðŸ›‘" }}

{{ $emojiSet := cslice $emojiAvailable $emojiRemove }}

{{ $embedFooter := (sdict
    "text" (printf
        "%s = available, %s = remove"
        $emojiAvailable
        $emojiRemove
    )
) }}

{{ $fieldNameAvailable := "Ready to Help!" }}
{{ $fieldNameAway := "Away" }}
{{ $fieldValueEmpty := "(none)" }}

{{ $fieldValueAvailable := $fieldValueEmpty }}
{{ $fieldValueAway := $fieldValueEmpty }}
{{ $fieldInline := true }}

{{ $fieldAvailable := (sdict "name" $fieldNameAvailable "value" $fieldValueAvailable "inline" $fieldInline) }}
{{ $fieldAway := (sdict "name" $fieldNameAway "value" $fieldValueAway "inline" $fieldInline) }}
{{ $fields := (cslice
        $fieldAvailable
        $fieldAway
    )
}}

{{ $embedDict := (sdict
    "title" $embedTitle
    "description" $embedDescription
    "color" $embedColor
    "footer" $embedFooter
    "fields" $fields
) }}

{{ $reactMessageId := .ExecData.messageId }}
{{ $reactEmoji := .ExecData.emoji }}
{{ $isReactionAdded := .ExecData.isReactionAdded }}
{{ $reactUserId := .ExecData.userId }}
{{ $reactUser := userArg $reactUserId }}

{{/* initial setup */}}
{{ if not .ExecData }}
    {{ $embed := cembed $embedDict }}

    {{ $messageId := sendMessageRetID nil $embed }}

    {{ range $emojiSet }}
        {{ addMessageReactions nil $messageId . }}
    {{ end }}

{{/* update existing embed, if present, based on expected emojis */}}
{{ else if in $emojiSet $reactEmoji }}
    {{ $reactMessage := getMessage nil $reactMessageId }}

    {{ range $index, $embed := $reactMessage.Embeds }}
        {{ if eq $embed.Title $embedTitle }}
            {{ if eq $reactEmoji $emojiAvailable }}
                {{ if $isReactionAdded }}
                    {{ $fieldValueAvailable = joinStr "\n" $reactUser.Mention }}
                {{ else }}
                    {{ $fieldValueAway = joinStr "\n" $reactUser.Mention }}
                {{ end }}
            {{ end }}

            {{ $fieldAvailable := (sdict "name" $fieldNameAvailable "value" $fieldValueAvailable "inline" $fieldInline) }}
            {{ $fieldAway := (sdict "name" $fieldNameAway "value" $fieldValueAway "inline" $fieldInline) }}
            {{ $fields := (cslice
                    $fieldAvailable
                    $fieldAway
                )
            }}

            {{ $embedDict.Set "fields" $fields }}

            {{ editMessage nil $reactMessageId (complexMessageEdit "embed" $embedDict) }}
        {{ end }}
    {{ end }}
{{ end }}
